(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t=document.querySelector("#card-template").content,n=document.querySelector(".places__list"),r=document.querySelector(".profile"),o=r.querySelector(".profile__edit-button"),c=r.querySelector(".profile__add-button"),a=document.querySelectorAll(".popup__close"),i=document.querySelector(".popup_type_update-avatar"),u=document.querySelector(".popup_type_edit"),l=document.querySelector(".popup_type_new-card"),s=document.querySelector(".popup_type_confirm"),d=document.forms.confirm,p=document.querySelector(".popup_type_image"),f=p.querySelector(".popup__caption"),m=p.querySelector(".popup__image"),v=document.forms["edit-profile"],y=v.elements.name,_=v.elements.description,h=document.forms["update-avatar"],b=h.elements["link-img"],S=document.forms["new-place"],g=S.elements["place-name"],k=S.elements.link,C=document.querySelector(".profile__image"),E=document.querySelector(".profile__title"),q=document.querySelector(".profile__description");function L(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),1),e.addEventListener("click",A),document.addEventListener("keydown",x)}function x(e){"Escape"===e.key&&O(document.querySelector(".popup_is-opened"))}function A(e){e.target===e.currentTarget&&O(e.currentTarget)}function O(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",A),document.removeEventListener("keydown",x),function(e){e.querySelector(".popup__form").reset()}(e)}function j(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function w(e,t){return fetch(e,t).then(j)}function P(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var r=t.submitter,o=r.textContent;P(!0,r,o,n),e().then((function(){t.target.reset(),O(t.target.closest(".popup"))})).catch(console.error).finally((function(){P(!1,r,o)}))}var T={baseUrl:"https://nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"b27457ff-8e1d-494d-8bc0-af82cbd7f253","Content-Type":"application/json"}};function U(e){e.classList.toggle("card__like-button_is-active")}function B(e){var n=e.card,r=e.userId,o=e.openPopupImg,c=e.likeCard,a=e.handleDelete,i=t.querySelector(".places__item").cloneNode(!0),u=i.querySelector(".card__title"),l=i.querySelector(".card__image"),s=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),p=i.querySelector(".card__like-counter"),f=n.owner._id,m=n.likes.length;return i.id=n._id,u.textContent="".concat(n.name),p.textContent="".concat(m),l.src="".concat(n.link),l.alt="Фото: ".concat(n.name),l.addEventListener("click",(function(){o(n.name,n.link)})),s.addEventListener("click",a),d.addEventListener("click",(function(e){!function(e){var t=e.card,n=e.buttonlikeCard,r=e.likeCounter,o=e.likeCard;n.classList.contains("card__like-button_is-active")?function(e){return w("".concat(T.baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:T.headers})}(t).then((function(e){o(n),r.textContent=e.likes.length})).catch(console.error):function(e){return w("".concat(T.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:T.headers})}(t).then((function(e){o(n),r.textContent=e.likes.length})).catch(console.error)}({card:n,buttonlikeCard:e.target,likeCounter:p,likeCard:c})})),function(e,t,n){e!==t&&n.remove()}(f,r,s),function(e,t,n){!function(e,t){return e.likes.some((function(e){return e._id===t}))}(e,t)?n.classList.remove("card__like-button_is-active"):n.classList.add("card__like-button_is-active")}(n,r,d),i}var D=["inputSelector","submitButtonSelector","inactiveButtonClass"],M=["submitButtonSelector","inputSelector","inactiveButtonClass"];function N(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var H=function(e,t,n){var r=t.inputErrorClass,o=t.errorClass,c=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(r),c.classList.remove(o),c.textContent=""};function J(e,t){e.classList.add(t),e.setAttribute("disabled",!0)}var V,z,$,F=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled",!0)):J(t,n)};function G(e,t){var n=t.submitButtonSelector,r=t.inputSelector,o=t.inactiveButtonClass,c=N(t,M),a=e.querySelector(n),i=Array.from(e.querySelectorAll(r));i.forEach((function(t){H(e,c,t),t.setCustomValidity("")})),F(i,a,o)}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Q(e){var t=e.target.closest(".card");s.dataset.cardId=t.id,L(s)}function R(e,t){m.src=t,m.alt=e,f.textContent=e,L(p)}function W(t){var n=t.target.closest(".popup"),r=n.querySelector(".popup__form");O(n),G(r,e)}z=(V=e).formSelector,$=N(V,["formSelector"]),Array.from(document.querySelectorAll(z)).forEach((function(e){!function(e,t){var n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,c=N(t,D),a=Array.from(e.querySelectorAll(n)),i=e.querySelector(r);F(a,i,o),e.addEventListener("reset",(function(){J(i,o)})),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}(t),t.validity.valid?H(e,n,t):function(e,t,n,r){var o=n.inputErrorClass,c=n.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),a.textContent=r,a.classList.add(c)}(e,t,n,t.validationMessage)}(e,t,c),F(a,i,o)}))}))}(e,$)})),o.addEventListener("click",(function(){y.value=E.textContent,_.value=q.textContent,G(v,e),L(u)})),v.addEventListener("submit",(function(e){var t=y.value,n=_.value;I((function(){return(e=t,r=n,w("".concat(T.baseUrl,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify({name:"".concat(e),about:"".concat(r)})})).then((function(e){E.textContent=e.name,q.textContent=e.about}));var e,r}),e)})),C.addEventListener("click",(function(){L(i)})),h.addEventListener("submit",(function(e){var t=b.value;I((function(){return function(e){return fetch("https://corsproxy.org/?".concat(e),{method:"HEAD"}).then((function(e){return e.ok?e.headers:Promise.reject("Запрос на изменение аватара не выполнен, ошибка: ".concat(e.status))})).then((function(t){return t.get("Content-type").includes("image")?function(e){return w("".concat(T.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify({avatar:"".concat(e)})})}(e):Promise.reject("Ссылка не на изображение, ошибка: ".concat(res.status))}))}(t).then((function(e){C.style="background-image: url(".concat(e.avatar,")")}))}),e)})),c.addEventListener("click",(function(){L(l)})),S.addEventListener("submit",(function(e){var t=g.value,r=k.value;I((function(){return(e=t,o=r,w("".concat(T.baseUrl,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify({name:"".concat(e),link:"".concat(o)})})).then((function(e){n.prepend(B({card:e,userId:e.owner._id,openPopupImg:R,likeCard:U,handleDelete:Q}))}));var e,o}),e)})),d.addEventListener("submit",(function(e){var t=s.dataset.cardId,r=n.querySelector('[id="'.concat(t,'"]'));I((function(){return function(e){return w("".concat(T.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:T.headers})}(t).then((function(){r.remove()}))}),e,"Удаление...")})),a.forEach((function(e){e.addEventListener("click",W)})),Promise.all([w("".concat(T.baseUrl,"/users/me"),{headers:T.headers}),w("".concat(T.baseUrl,"/cards"),{headers:T.headers})]).then((function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];C.style="background-image: url(".concat(c.avatar,")"),E.textContent="".concat(c.name),q.textContent="".concat(c.about),a.forEach((function(e){var t=B({card:e,userId:c._id,openPopupImg:R,likeCard:U,handleDelete:Q});n.append(t)}))})).catch(console.error)})();
//# sourceMappingURL=main.js.map